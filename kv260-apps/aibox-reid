FROM som-develop:latest as build
WORKDIR /workspace

RUN \
mkdir -p /tmp/xilinx; \
    cd /tmp/xilinx; \
    wget https://gitenterprise.xilinx.com/SOM/aibox-reid/archive/refs/heads/xlnx_rel_v2022.1.zip ; \
    unzip xlnx_rel_v2022.1.zip; \
    cd aibox-reid-xlnx_rel_v2022.1 ;  \
    sed -i 's#"vvas-library-repo": "/usr/lib/"#"vvas-library-repo": "/usr/lib/aarch64-linux-gnu/"#g' config/refinedet.json ; \
    mkdir -p build;  \
    cd build; \                           
    cmake ../  -DCMAKE_INSTALL_PREFIX:PATH=/ ; make; make install  DESTDIR=./install  ; 

FROM som-runtime:latest
RUN \
    apt install --yes graphviz ; \
    pip install pydot ; 

COPY --from=build /workspace/aibox-reid-xlnx_rel_v2022.1/build/install /

ENV PATH="${PATH}:/opt/xilinx/kv260-aibox-reid/bin"
ENV LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:/opt/xilinx/kv260-aibox-reid/lib"

